---
name: 麦秆画定制网站
overview: 基于现有MkSaaS模板，开发一个中国麦秆画定制销售网站，用户可以通过AI生成麦秆画风格图片，选择产品规格并支付，后台管理订单和发货流程。
todos:
  - id: database-schema
    content: 扩展数据库schema（订单表、产品规格表），生成并应用migrations
    status: completed
  - id: wheat-straw-prompts
    content: 创建麦秆画风格提示词工程模块
    status: completed
  - id: image-generator
    content: 开发麦秆画生成器组件（支持上传图片和文本提示词）
    status: completed
    dependencies:
      - wheat-straw-prompts
  - id: product-customization
    content: 创建产品定制页面（规格选择、地址填写、价格计算）
    status: completed
    dependencies:
      - database-schema
  - id: payment-integration
    content: 扩展支付系统支持实体产品订单
    status: completed
    dependencies:
      - database-schema
      - product-customization
  - id: user-orders
    content: 开发用户订单查看页面（列表和详情）
    status: completed
    dependencies:
      - database-schema
  - id: admin-orders
    content: 开发管理员订单管理后台
    status: completed
    dependencies:
      - database-schema
  - id: email-templates
    content: 创建订单相关邮件模板（确认、制作、发货、完成）
    status: completed
  - id: homepage-ui
    content: 改造首页突出麦秆画定制服务
    status: completed
    dependencies:
      - image-generator
  - id: i18n-content
    content: 添加中英文国际化内容
    status: completed
  - id: admin-product-config
    content: 创建产品规格管理后台页面
    status: completed
    dependencies:
      - database-schema
---

# 麦秆画定制网站开发计划

## 1. 数据库Schema扩展

### 1.1 创建麦秆画订单表

在 [`src/db/schema.ts`](src/db/schema.ts) 中添加：

- `wheatStrawOrder` 表：订单核心信息
- 订单ID、用户ID、订单状态（paid, in_production, shipped, completed, cancelled）
- 原始图片URL、生成的麦秆画图片URL、用户提示词
- 产品规格（尺寸、是否配框、装裱方式）、价格
- 收货地址信息（姓名、电话、地址）
- 物流信息（快递公司、运单号）
- 支付信息（payment_id关联）
- 时间戳（创建、支付、发货、完成时间）

### 1.2 创建产品规格配置表

- `productOption` 表：产品规格和价格配置
- 尺寸选项（20x30cm, 30x40cm, 40x60cm等）
- 配框选项（无框、木框、金属框）
- 装裱方式（简装、精装）
- 每个选项的价格增量

运行 `pnpm db:generate` 和 `pnpm db:migrate` 应用数据库更改。

## 2. AI图片生成定制

### 2.1 麦秆画风格提示词工程

修改 [`src/ai/image`](src/ai/image) 相关文件：

- 创建 `src/ai/image/lib/wheat-straw-prompts.ts`：
- 定义麦秆画风格的基础提示词模板
- 实现提示词增强函数，自动添加麦秆画艺术风格描述
- 支持中英文提示词转换

### 2.2 图片上传和转换功能

创建 `src/ai/image/components/WheatStrawGenerator.tsx`：

- 支持用户上传图片（使用现有的S3存储集成）
- 将上传的图片通过image-to-image API转换为麦秆画风格
- 提供文本提示词输入选项
- 显示生成的麦秆画预览

### 2.3 图片修改功能

- 允许用户修改提示词并重新生成
- 保存历史生成记录供用户选择
- 实现图片对比视图（原图 vs 麦秆画效果）

## 3. 产品定制和支付流程

### 3.1 创建产品定制页面

创建 `src/app/[locale]/(marketing)/wheat-straw/customize/page.tsx`：

- 显示用户选定的麦秆画图片
- 产品规格选择器（使用Radix UI组件）：
- 尺寸选择（RadioGroup）
- 配框选项（Select）
- 装裱方式（RadioGroup）
- 实时价格计算显示
- 收货地址表单（使用react-hook-form + Zod验证）

### 3.2 扩展支付系统

修改 [`src/payment/types.ts`](src/payment/types.ts)：

- 添加新的支付场景：`PHYSICAL_PRODUCT = 'physical_product'`
- 创建 `src/actions/create-wheat-straw-checkout.ts`：
- 创建麦秆画订单记录
- 生成Stripe checkout session
- 关联订单和支付信息

### 3.3 支付成功处理

修改 Stripe webhook处理（`src/app/api/stripe/webhook/route.ts`）：

- 监听 `invoice.paid` 事件
- 更新麦秆画订单状态为 `paid`
- 发送订单确认邮件给用户

## 4. 订单管理系统

### 4.1 用户订单页面

创建 `src/app/[locale]/(protected)/orders/page.tsx`：

- 列表显示用户的所有订单
- 订单卡片展示：缩略图、订单号、状态、价格
- 点击查看订单详情

创建 `src/app/[locale]/(protected)/orders/[orderId]/page.tsx`：

- 显示完整订单信息
- 显示物流追踪信息（如已发货）
- 订单状态时间线

### 4.2 管理员订单管理后台

创建 `src/app/[locale]/(protected)/admin/orders/page.tsx`：

- 订单列表（按状态筛选：全部、已支付、制作中、已发货、已完成）
- 订单搜索（按订单号、用户名、手机号）
- 批量操作（导出订单、批量更新状态）

创建 `src/app/[locale]/(protected)/admin/orders/[orderId]/page.tsx`：

- 订单详情编辑页面
- 更新订单状态（下拉选择）
- 录入物流信息表单
- 查看客户信息和产品规格
- 下载高清麦秆画图片用于制作

### 4.3 Server Actions

创建以下server actions在 `src/actions/`:

- `get-wheat-straw-orders.ts`：获取订单列表（用户/管理员）
- `get-wheat-straw-order-detail.ts`：获取订单详情
- `update-order-status.ts`：更新订单状态
- `update-shipping-info.ts`：更新物流信息
- `cancel-order.ts`：取消订单（限制条件）

## 5. 邮件通知系统

在 [`src/mail/templates/`](src/mail/templates/) 创建邮件模板：

- `wheat-straw-order-confirmation.tsx`：订单确认邮件
- `wheat-straw-order-in-production.tsx`：制作中通知
- `wheat-straw-order-shipped.tsx`：发货通知（含物流信息）
- `wheat-straw-order-completed.tsx`：订单完成通知

## 6. UI界面调整

### 6.1 首页改造

修改 [`src/app/[locale]/(marketing)/(home)/page.tsx`](src/app/[locale]/(marketing)/(home)/page.tsx)：

- Hero区域突出麦秆画定制服务
- 展示麦秆画作品案例轮播
- 添加"立即定制"CTA按钮
- 展示定制流程（上传/输入 → AI生成 → 选规格 → 支付 → 收货）

### 6.2 麦秆画生成器主页面

创建 `src/app/[locale]/(marketing)/wheat-straw/page.tsx`：

- 使用修改后的 `WheatStrawGenerator` 组件
- 侧边栏显示麦秆画艺术介绍
- 示例图片gallery
- 指导用户如何输入提示词获得最佳效果

### 6.3 配置和导航

修改 [`src/config/website.tsx`](src/config/website.tsx)：

- 更新网站名称、logo、描述为麦秆画相关
- 禁用不需要的功能（博客、文档等，可选）

添加导航链接：

- 顶部导航添加"定制麦秆画"入口
- 用户dashboard添加"我的订单"链接
- 管理员菜单添加"订单管理"

## 7. 国际化

更新 [`messages/zh.json`](messages/zh.json) 和 [`messages/en.json`](messages/en.json)：

- 添加麦秆画相关所有文案
- 订单状态翻译
- 产品规格选项翻译
- 表单验证错误信息

## 8. 产品规格管理

创建 `src/app/[locale]/(protected)/admin/product-options/page.tsx`：

- 管理员配置产品规格和价格
- CRUD操作（增删改查尺寸、配框、装裱选项）
- 设置基础价格和各选项增量价格